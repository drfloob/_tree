/*! under_tree - v0.2.8 - 2014-02-05
    (c) 2013 A.J. Heller
    _tree.js may be freely distributed under the MIT License.
*/

!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["underscore"],b):"object"==typeof exports?module.exports=b(require("underscore")):a._tree=b(a._)}(this,function(a){"use strict";function b(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function c(b){function c(d,e){d.__tree=b,e&&(d.__parent=e);try{Object.freeze(d),Object.freeze(d.__children)}catch(f){}a.each(d.children(),function(a){c(a,d)})}a.each(b.defaults.mixins,function(c){a.each(c,function(a,c){b[c]=a})});try{Object.freeze(b)}catch(d){}c(b.root()),a.each(b.defaults.callbacks.afterUpdate,function(a){a(b)})}function d(b){return b=b?a.clone(b):{},b.callbacks=a.defaults(a.clone(b.callbacks||{}),g.callbacks),b.mixins=a.union(b.mixins||[],g.mixins),b=a.defaults(b,g)}var e,f,g,h={};return h.inflate=function(a,b,f){f=d(f),b=f.inflate=b||f.inflate;var g=new e(f,a,b);return c(g),g},h.create=function(a){return h.inflate(null,null,a)},h.inflate.byKey=function(b){return b=b||"children",function(c){this.emit(c),a.has(c,b)&&this.children(c[b])}},h.inflate.byAdjacencyList=function(b){var c,d,e;if(this.emit(a.first(b)),b.length>1){if(!a.isArray(b[1])||b.length>2)throw"invalid adjacency list";for(c=b[1],e=0;e<c.length;e++)d=[c[e]],c.length>1&&a.isArray(c[e+1])&&(d.push(c[e+1]),e++),this.children([d])}},h.inflate.onlyLeavesList=function(b){if(!a.isArray(b)||b.length>1)throw"invalid leaves list";a.isArray(a.first(b))?this.children(a.map(a.first(b),function(a){return[a]})):this.emit(a.first(b))},h.fromNode=function(a,b){if(!(a instanceof f))throw new Error("invalid node: "+JSON.stringify(a));b=d(b);var g=new e(b);return g.__root=f.clone(g,a),c(g),g},e=function(a,c,d,g){this.defaults=a;var h,i,j;h=b(),i=g||0;try{Object.defineProperties(this,{__id:{value:h,writable:!0,enumerable:!1,configurable:!1},__nextNodeId:{value:i,writable:!0,enumerable:!1,configurable:!1}})}catch(k){this.__id=h,this.__nextNodeId=i}j=c&&d?e.inflate(this,c,d):new f(this);try{Object.defineProperties(this,{__root:{writable:!0,enumerable:!1,configurable:!1,value:j}})}catch(k){this.__root=j}},e.clone=function(a){var b=new e(a.defaults);return b.__root=f.clone(b,a.root()),b.__nextNodeId=a.__nextNodeId,b.__id=a.__id,b},e.inflate=function(b,c,d){var g,h=new f(b);return b.__root=h,g={emit:function(a){h.__data=a},children:function(c){a.each(c,function(a){var c=new e(b.defaults,a,d,b.__nextNodeId);h.__children.push(c.root()),c.root().__parent=h,b.__nextNodeId=c.__nextNodeId})}},d.call(g,c),h},e.prototype.root=function(){return this.__root},e.prototype.findNode=function(a,b){if(!(a instanceof f))throw"not a node";if(!this.equals(a.__tree))return!1;var c=!1;return this.walk(function(b){!c&&a.equals(b)&&(c=b)},b),c},e.prototype.findNodeByData=function(b,c){var d,e,f=!1;return a.isUndefined(b)?!1:(a.isObject(b)&&!a.isArray(b)?(e=a.keys(b),d=function(c){return!a.isObject(c)||a.isArray(c)?!1:a.isEqual(b,a.partial(a.pick,c).apply(a,e))}):d=function(c){return a.isEqual(b,c)},this.walk(function(a){!f&&d(a.__data)&&(f=a)},c),f)},e.prototype.walk=function(b,c,d){c=c||this.defaults.walk;var e,f,g=[],h=[];if(d){if(!this.containsNode(d))throw new Error("startNode does not exist in the tree")}else d=this.root();for(e={queue:function(a){g=g.concat(a)},push:function(a){g=a.concat(g)},recurse:function(b){a.each(b,function(a){c.call(e,a)})},queueRecurse:function(a){h=h.concat(a)}},c.call(e,d);h.length>0;)f=h.shift(),c.call(e,f);a.each(g,b)},e.prototype.walk.dfpre=function(a){this.queue(a),this.recurse(a.children())},e.prototype.walk.dfpost=function(a){this.recurse(a.children()),this.queue(a)},e.prototype.walk.bfpre=function(a){a.parent()||this.queue([a]),this.queue(a.children()),this.recurse(a.children())},e.prototype.walk.bfpost=function(b){b.parent()||this.push([b]),this.push(b.children());var c=a.clone(b.children());c.reverse(),this.queueRecurse(c)},e.prototype.equals=function(a){return a instanceof e&&this.__id===a.__id},e.prototype.containsNode=function(a){return this.findNode(a)instanceof f},e.prototype.containsData=function(a){return this.findNodeByData(a)instanceof f},e.prototype.moveNode=function(a,b){return a.remove().findNode(b).addChildNode(a)},e.prototype.on=function(b,d){var f,g;return f=e.clone(this),g=a.isArray(d)?d:[d],f.defaults.callbacks[b]=f.defaults.callbacks[b].concat(g),c(f),f},e.prototype.off=function(b,d){var f,g;return f=e.clone(this),g=a.isArray(d)?d:[d],f.defaults.callbacks[b]=a.partial(a.without,f.defaults.callbacks[b]).apply(a,g),c(f),f},e.prototype.mixin=function(b){var d;return d=e.clone(this),a.contains(d.defaults.mixins,b)||d.defaults.mixins.push(b),c(d),d},f=function(a){try{Object.defineProperties(this,{__tree:{value:a,writable:!0,enumerable:!1,configurable:!1},__data:{writable:!0,enumerable:!1,configurable:!1},__children:{value:[],writable:!0,enumerable:!1,configurable:!1},__id:{value:a.__nextNodeId,writable:!0,enumerable:!1,configurable:!1}})}catch(b){this.__tree=a,this.__data=void 0,this.__children=[],this.__id=a.__nextNodeId}a.__nextNodeId=a.__nextNodeId+1},f.clone=function(b,c,d){var e=new f(b);return e.__data=c.__data,e.__children=a.map(c.children(),function(a){return f.clone(b,a,d)}),a.each(e.__children,function(a){a.__parent=e}),d||(e.__id=c.__id,b.__nextNodeId--),e},f.prototype.data=function(a){if(!a)return this.__data;var b,d;return b=e.clone(this.__tree),d=b.findNode(this),d.__data=a,c(b),b},f.prototype.children=function(){return this.__children},f.prototype.parent=function(){return this.__parent},f.prototype.tree=function(){return this.__tree},f.prototype.id=function(){return this.__id},f.prototype.parseAndAddChild=function(a,b){b=b||this.__tree.defaults.inflate;var d,f,g,h;return h=this.__tree,d=new e(h.defaults,a,b,h.__nextNodeId),f=e.clone(h),g=f.findNode(this),g.__children.push(d.root()),d.root().__parent=g,f.__nextNodeId=d.__nextNodeId,c(f),f},f.prototype.addChildNode=function(a){var b,d,g;return b=e.clone(this.tree()),d=b.findNode(this),b.__nextNodeId=this.tree().__nextNodeId,g=f.clone(b,a,!0),d.__children.push(g),g.__parent=d,c(b),b},f.prototype.equals=function(a){return this.__tree.equals(a.__tree)&&this.__id===a.__id},f.prototype.remove=function(){if(this===this.__tree.__root)throw new Error("cannot delete the root node");var b,d,f;return b=e.clone(this.__tree),d=b.findNode(this),f=b.findNode(this.__parent),f.__children=a.without(f.__children,d),c(b),b},g={inflate:h.inflate.byKey(),walk:e.prototype.walk.dfpre,deleteRecursive:!0,callbacks:{afterUpdate:[]},mixins:[]},h});
//# sourceMappingURL=dist/_tree.min.js.map