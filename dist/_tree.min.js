/*! _tree - v0.1.1 - 2013-10-29
    (c) 2013 A. J. Heller
    _tree.js may be freely distributed under the MIT License.
*/
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["underscore"],b):"object"==typeof exports?module.exports=b(require("underscore")):a._tree=b(a._)}(this,function(a){"use strict";function b(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"===a?b:8|3&b;return c.toString(16)})}function c(b){function c(d,e){d.__tree=b,e&&(d.__parent=e),Object.freeze(d),Object.freeze(d.__children),a.each(d.children(),function(a){c(a,d)})}Object.freeze(b),c(b.root())}var d,e,f,g={};return g.inflate=function(b,e,g){g=a.defaults(a.clone(g||{}),f),e=g.inflate=e||g.inflate;var h=new d(g,b,e);return c(h),h},g.create=function(a){return g.inflate(null,null,a)},g.inflate.byKey=function(b){return b=b||"children",function(c){this.emit(c),a.has(c,b)&&this.children(c[b])}},g.inflate.byAdjacencyList=function(b){var c,d,e;if(this.emit(a.first(b)),b.length>1&&a.isArray(b[1]))for(c=b[1],e=0;e<c.length;e++)d=[c[e]],c.length>1&&a.isArray(c[e+1])&&(d.push(c[e+1]),e++),this.children([d])},g.inflate.onlyLeavesList=function(b){a.isArray(a.first(b))?this.children(a.first(b)):this.emit(a.first(b))},d=function(a,c,f,g){this.defaults=a,this.__id=b(),this.__nextNodeId=g||0,this.__root=c&&f?d.inflate(this,c,f):new e(this)},d.clone=function(a){var b=new d(a.defaults);return b.__root=e.clone(b,a.root()),b.__id=a.__id,b},d.inflate=function(b,c,f){var g,h=new e(b);return b.__root=h,g={emit:function(a){h.__data=a},children:function(c){a.each(c,function(a){var c=new d(b.defaults,a,f,b.__nextNodeId);h.__children.push(c.root()),c.root().__parent=h,b.__nextNodeId=c.__nextNodeId})}},f.call(g,c),h},d.prototype.root=function(){return this.__root},d.prototype.findNode=function(a,b){if(!this.equals(a.__tree))return!1;var c=!1;return this.walk(function(b){!c&&a.equals(b)&&(c=b)},b),c},d.prototype.findByData=function(b,c){if(a.isUndefined(b))return!1;var d=!1;return this.walk(function(c){!d&&a.isEqual(b,c.__data)&&(d=c)},c),d},d.prototype.walk=function(b,c){c=c||this.defaults.walk;var d,e,f=[],g=[];for(d={queue:function(a){f=f.concat(a)},push:function(a){f=a.concat(f)},recurse:function(b){a.each(b,function(a){c.call(d,a)})},queueRecurse:function(a){g=g.concat(a)}},c.call(d,this.root());g.length>0;)e=g.shift(),c.call(d,e);a.each(f,b)},d.prototype.walk.dfpre=function(a){this.queue(a),this.recurse(a.children())},d.prototype.walk.dfpost=function(a){this.recurse(a.children()),this.queue(a)},d.prototype.walk.bfpre=function(a){a.parent()||this.queue([a]),this.queue(a.children()),this.recurse(a.children())},d.prototype.walk.bfpost=function(b){b.parent()||this.push([b]),this.push(b.children());var c=a.clone(b.children());c.reverse(),this.queueRecurse(c)},d.prototype.equals=function(a){return this.__id===a.__id},d.prototype.contains=function(a){return this.findNode(a)instanceof e},d.prototype.sample=function(){throw new Error("not implemented")},e=function(a){this.__tree=a,this.__data=void 0,this.__children=[],this.__id=a.__nextNodeId,a.__nextNodeId=a.__nextNodeId+1},e.clone=function(b,c){var d=new e(b);return d.__data=c.__data,d.__children=a.map(c.children(),a.partial(e.clone,b)),d.__id=c.__id,d},e.prototype.data=function(a){if(!a)return this.__data;var b,e;if(b=d.clone(this.__tree),e=b.findNode(this),!e)throw new Error(["Internal Error: Node not found in new tree",this,b]);return e.__data=a,c(b),b},e.prototype.children=function(){return this.__children||[]},e.prototype.parent=function(){return this.__parent},e.prototype.addChild=function(a,b){b=b||this.__tree.defaults.inflate;var e,f,g,h;if(h=this.__tree,e=new d(h.defaults,a,b,h.__nextNodeId),f=d.clone(h),g=f.findNode(this),!g)throw new Error(["Internal Error: Node not found in new tree",this,f]);return g.__children.push(e.root()),e.root().__parent=g,f.__nextNodeId=e.__nextNodeId,c(f),f},e.prototype.equals=function(a){return this.__tree.equals(a.__tree)&&this.__id===a.__id},e.prototype.delete=function(){if(this===this.__tree.__root)throw new Error("cannot delete the root node");var b,e,f;if(b=d.clone(this.__tree),e=b.findNode(this),!e)throw new Error(["Internal Error: Node not found in new tree",this,b]);if(f=b.findNode(this.__parent),!f)throw new Error(["Internal Error: Node not found in new tree",f,b]);return f.__children=a.without(f.__children,e),c(b),b},f={inflate:g.inflate.byKey(),walk:d.prototype.walk.dfpre,deleteRecursive:!0},g});
//# sourceMappingURL=dist/_tree.min.js.map